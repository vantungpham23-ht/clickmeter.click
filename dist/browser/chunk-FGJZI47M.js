import{a as N,b as W,e as B,g as K,h as V,i as z,m as J}from"./chunk-ZB4PSO4W.js";import{a as j,b as v,c as L}from"./chunk-RQ6ZZBPF.js";import"./chunk-X5YLR3NI.js";import{Ea as h,Ga as p,Ia as o,Ja as a,Ma as g,N as x,Na as b,Pa as s,Qa as E,Ra as m,S,Sa as y,Ta as _,Ua as C,V as M,Wa as O,Xa as I,Ya as w,oa as D,rb as P,sb as A,ta as r,tb as F,ua as f,ub as k,wb as T}from"./chunk-VW5W7YTQ.js";import{i as c}from"./chunk-ODN5LVDJ.js";var u=class i{constructor(t){this.platformId=t;T(this.platformId)&&(this.supabase=j(v.supabase.url,v.supabase.anonKey))}supabase=null;getAnalyticsData(t,n){return c(this,null,function*(){if(!this.supabase)return null;let{data:e,error:l}=yield this.supabase.functions.invoke("get-cloudflare-analytics",{method:"POST",body:{site_id:t,date_from:n}});return l?(console.error("Error invoking function:",l),null):e})}getMySites(){return c(this,null,function*(){if(!this.supabase)return[];let{data:{session:t}}=yield this.supabase.auth.getSession();if(!t)return[];let{data:n,error:e}=yield this.supabase.from("sites").select("id, site_name, filter_path");return e?(console.error("Error fetching sites:",e),[]):n})}static \u0275fac=function(n){return new(n||i)(S(D))};static \u0275prov=x({token:i,factory:i.\u0275fac,providedIn:"root"})};function G(i,t){if(i&1&&(o(0,"option",15),s(1),a()),i&2){let n=t.$implicit;p("value",n.id),r(),m(" ",n.site_name," ")}}function H(i,t){if(i&1&&(o(0,"div",16),s(1),a()),i&2){let n=b();r(),m(" ",n.errorMessage," ")}}function Q(i,t){if(i&1&&(o(0,"div",17)(1,"div",18)(2,"h3"),s(3,"D\u1EEF li\u1EC7u Analytics"),a(),o(4,"pre"),s(5),I(6,"json"),a()()()),i&2){let n=b();r(5),E(w(6,1,n.analyticsData))}}function U(i,t){i&1&&(o(0,"div",19)(1,"p"),s(2,"Ch\u1ECDn site v\xE0 ng\xE0y \u0111\u1EC3 xem d\u1EEF li\u1EC7u analytics"),a()())}var R=class i{constructor(t,n){this.analyticsService=t;this.authService=n}sites=[];selectedSiteId=null;dateFrom="";analyticsData=null;isLoading=!1;errorMessage="";ngOnInit(){return c(this,null,function*(){yield this.loadSites();let t=new Date;t.setDate(t.getDate()-7),this.dateFrom=t.toISOString().split("T")[0]})}loadSites(){return c(this,null,function*(){try{this.sites=yield this.analyticsService.getMySites(),this.sites.length>0&&(this.selectedSiteId=this.sites[0].id)}catch(t){console.error("Error loading sites:",t),this.errorMessage="Kh\xF4ng th\u1EC3 t\u1EA3i danh s\xE1ch site"}})}loadAnalytics(){return c(this,null,function*(){if(!this.selectedSiteId||!this.dateFrom){this.errorMessage="Vui l\xF2ng ch\u1ECDn site v\xE0 ng\xE0y b\u1EAFt \u0111\u1EA7u";return}this.isLoading=!0,this.errorMessage="";try{this.analyticsData=yield this.analyticsService.getAnalyticsData(this.selectedSiteId,this.dateFrom)}catch(t){console.error("Error loading analytics:",t),this.errorMessage="Kh\xF4ng th\u1EC3 t\u1EA3i d\u1EEF li\u1EC7u analytics"}finally{this.isLoading=!1}})}onSiteChange(){this.analyticsData=null}onDateChange(){this.analyticsData=null}static \u0275fac=function(n){return new(n||i)(f(u),f(L))};static \u0275cmp=M({type:i,selectors:[["app-dashboard"]],standalone:!0,features:[O],decls:23,vars:8,consts:[[1,"dashboard-container"],[1,"dashboard-header"],[1,"btn-logout",3,"click"],[1,"dashboard-controls"],[1,"control-group"],["for","site-select"],["id","site-select",1,"form-control",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","date-from"],["type","date","id","date-from",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"btn-primary",3,"click","disabled"],["class","error-message",4,"ngIf"],["class","analytics-content",4,"ngIf"],["class","no-data",4,"ngIf"],[3,"value"],[1,"error-message"],[1,"analytics-content"],[1,"analytics-card"],[1,"no-data"]],template:function(n,e){n&1&&(o(0,"div",0)(1,"div",1)(2,"h1"),s(3,"Analytics Dashboard"),a(),o(4,"button",2),g("click",function(){return e.authService.signOut()}),s(5," \u0110\u0103ng xu\u1EA5t "),a()(),o(6,"div",3)(7,"div",4)(8,"label",5),s(9,"Ch\u1ECDn Site:"),a(),o(10,"select",6),C("ngModelChange",function(d){return _(e.selectedSiteId,d)||(e.selectedSiteId=d),d}),g("change",function(){return e.onSiteChange()}),o(11,"option",7),s(12,"-- Ch\u1ECDn site --"),a(),h(13,G,2,2,"option",8),a()(),o(14,"div",4)(15,"label",9),s(16,"T\u1EEB ng\xE0y:"),a(),o(17,"input",10),C("ngModelChange",function(d){return _(e.dateFrom,d)||(e.dateFrom=d),d}),g("change",function(){return e.onDateChange()}),a()(),o(18,"button",11),g("click",function(){return e.loadAnalytics()}),s(19),a()(),h(20,H,2,1,"div",12)(21,Q,7,3,"div",13)(22,U,3,0,"div",14),a()),n&2&&(r(10),y("ngModel",e.selectedSiteId),r(3),p("ngForOf",e.sites),r(4),y("ngModel",e.dateFrom),r(),p("disabled",e.isLoading||!e.selectedSiteId||!e.dateFrom),r(),m(" ",e.isLoading?"\u0110ang t\u1EA3i...":"T\u1EA3i d\u1EEF li\u1EC7u"," "),r(),p("ngIf",e.errorMessage),r(),p("ngIf",e.analyticsData),r(),p("ngIf",!e.analyticsData&&!e.isLoading&&!e.errorMessage))},dependencies:[k,P,A,F,J,V,z,N,K,W,B],styles:[".dashboard-container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.dashboard-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #e1e5e9}h1[_ngcontent-%COMP%]{color:#333;margin:0;font-weight:600}.btn-logout[_ngcontent-%COMP%]{background:#e74c3c;color:#fff;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;font-weight:500;transition:background-color .3s ease}.btn-logout[_ngcontent-%COMP%]:hover{background:#c0392b}.dashboard-controls[_ngcontent-%COMP%]{display:flex;gap:20px;align-items:end;margin-bottom:30px;flex-wrap:wrap}.control-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:200px}label[_ngcontent-%COMP%]{margin-bottom:5px;color:#555;font-weight:500}.form-control[_ngcontent-%COMP%]{padding:10px;border:2px solid #e1e5e9;border-radius:6px;font-size:14px;transition:border-color .3s ease}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;font-weight:500;transition:transform .2s ease;height:fit-content}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px)}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.error-message[_ngcontent-%COMP%]{color:#e74c3c;background:#fdf2f2;padding:15px;border-radius:6px;margin-bottom:20px;border-left:4px solid #e74c3c}.analytics-content[_ngcontent-%COMP%]{margin-top:30px}.analytics-card[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 10px #0000001a}.analytics-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#333}.analytics-card[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{background:#f8f9fa;padding:15px;border-radius:6px;overflow-x:auto;font-size:12px;line-height:1.4}.no-data[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666;font-style:italic}@media (max-width: 768px){.dashboard-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.control-group[_ngcontent-%COMP%]{min-width:auto}}"]})};export{R as DashboardComponent};
